<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>RPG Developer NEXT 取扱説明書</title>
<link rel="stylesheet" type="text/css" href="css/reset.css">
<link rel="stylesheet" type="text/css" href="css/style.css">
<script src="js/jquery.min.js"></script>
<script src="js/script.js"></script>
<script src="js/auto-document.js"></script>
<script src="js/version-getter.js"></script>
</head>

<body class="node_editor-map">
<!-- タイトルバー -->
<div id="header">
  <a href="index.html"><h1><span>RPG Developer NEXT</span> <script>PrintVersion();</script> 取扱説明書</h1></a>
</div>

<div id="container">
<!-- 目次サイドバー -->
<div id="menuContainer">
  <div id="menuContent">
    <script src="js/manual-tree.js"></script>
    <script src="js/auto-tree.js"></script>
  </div>
</div>

<!-- メインコンテンツ -->
<div id="mainContainer">
  <!-- ぱんくずリスト [&gt]=[>] -->
  <div id="breadcrumb"><a href="index.html">HOME</a> &gt; <a href="editor.html">エディター部</a> &gt; マップ エディター</div>

  <!-- 親ノード見出し -->
  <h2>マップ エディター</h2>
  <div class="text">
    <!-- 親ノードのテキスト -->
    <p>
      ゲームの舞台となるマップを編集します。<br>
      正方形のタイルを並べていき、これを層にして重ねていきます。<br>
      マップ上での出来事は「イベント」と呼び、スクリプトを介して自由に作り込むことができます。<br>
      イベントは内部に「ページ」を最大10個まで持つことができ、条件に応じて表示や振る舞いを切り替えられる仕組みがあります。<br>
    </p>
  </div>
  <hr>

  <!-- 子ノード見出し -->
  <h3 id="1">マップの基本構造</h3>
  <div class="text">
    <!-- 子ノードのテキスト -->
    <p>
      [タイル定義ファイル] … マップに関する各種設定、レイヤーごとのタイル情報が格納されています。<br>
    </p>
    <ul class="disc">
      <li>メタ情報（マップ設定情報）</li>
      <li>下層（タイルパレット位置とオートタイル接続情報のペア）</li>
      <li>中層（同様）</li>
      <li>上層（同様）</li>
      <li>影層（1タイルを1/4に分割した情報の集合）</li>
    </ul>

    <p style="margin-top: 1rem;">
      [イベントスクリプト] … 対応するマップのイベントの動作を定義したスクリプトです。<br>
    </p>
    <ul class="disc">
      <li>
        イベント初期配置処理<br>
        マップ遷移した際に一度だけ実行され、イベントの配置処理が行われます。<br>
      </li>
      <li>
        ページ条件・起動条件・日常移動・実行内容<br>
        イベントごと、ページごとに記述されます。<br>
        ページ条件の判定はページ番号の降順に、リアルタイムで行われます。<br>
      </li>
    </ul>
  </div>
  <hr>

  <!-- 子ノード見出し -->
  <h3 id="2">ファイルツリー</h3>
  <div class="text">
    <!-- 子ノードのテキスト -->
    <p>
      プロジェクトフォルダーの「Maps」フォルダー以下が表示されています。<br>
      ここからファイルやフォルダーの各種操作ができますが、一部機能が仕様により制限されています。詳しくは <a href="editor.html#6">細かい動作仕様</a> をご覧下さい。<br>
      なお、マップファイルの拡張子（ファイル名末尾の文字列）は「.map」にする必要があります。<br>
    </p>
  </div>
  <hr>

  <!-- 子ノード見出し -->
  <h3 id="3">レイヤー</h3>
  <div class="text">
    <!-- 子ノードのテキスト -->
    <p>
      エディター画面左のチェックボックスが付いたリストから選択します。<br>
      チェックを外すと、エディター上では不可視な状態となります。<br>
      ここで選択しているレイヤーが編集できるレイヤーになります。<br>
      下層～上層はタイルパレットが表示され、イベントレイヤーを選択するとイベントの一覧が表示されます。<br>
    </p>
  </div>
  <hr>

  <!-- 子ノード見出し -->
  <h3 id="4">タイルパレット</h3>
  <div class="text">
    <!-- 子ノードのテキスト -->
    <p>
      下層～上層を選択しているときに表示されます。<br>
      ここで表示されるタイルパレットは、タイルパレットDBのデータに連動しています。<br>
      ここで選択したタイルがデザイナー上で配置されます。<br>
    </p>
  </div>
  <hr>

  <!-- 子ノード見出し -->
  <h3 id="5">デザイナー</h3>
  <div class="text">
    <!-- 子ノードのテキスト -->
    <p>
      マップ上の画面に見立てて、ここにタイルを配置していきます。<br>
      ペイントツールのような感覚で操作できます。<br>
    </p>

    <h4>ツールバー：画像でエクスポート</h4>
    <p>
      編集中のマップの全景をJPEG形式の画像ファイルとして書き出します。<br>
      ただし、一辺が1920pxを超えるような画像は正常に書き出せないため、スケールを調整して縮小する必要があります。<br>
    </p>

    <h4>ツールバー：マップ設定</h4>
    <ul class="disc">
      <li>[ループ] … マップの上端と下端、左端と右端でループするかどうかを設定します。ループを有効にすると、いわゆる「地球は丸い」という状態になります。</li>
      <li>[カーボン元] … 詳しくは <a href="qa.html">よくある質問</a> の「マップ：カーボン機能とは何か？」をご覧下さい。</li>
      <li>[遠景] … マップの背景グラフィックです。全層が空白タイルの部分に表示されます。</li>
      <li>[フォグ] … マップの前景グラフィックです。名称の通り「霧」のような一般的に透過領域の多いグラフィックが使われます。</li>
      <li>[エンカウント] … 移動中に遭遇する敵ユニットの設定を行います。重複して登録することで遭遇率を疑似的に上げることもできます。</li>
      <li>[エンカウント係数] … エンカウントが発生する頻度を示します。プリセットのスクリプトでは、0のときエンカウントしない状態で、100が標準値です。</li>
    </ul>

    <h4>ツールバー：スクリプトイベントを編集</h4>
    <p>
      編集中のマップに対応するイベントスクリプトをテキストエディターで開き、2ペイン表示にします。<br>
      単純なイベント編集とは異なり、エディターが内部的に読み書きする部分も見えてしまいます。<br>
      この編集操作に不備があるとエディターから開けなくなることがありますので、くれぐれもご注意下さい。<br>
    </p>

    <h4>ツールバー：シフト</h4>
    <p>
      イベントレイヤーを含む全レイヤーを指定タイル分だけ移動させます。<br>
      範囲外に出た部分はループして反対側の端に移動します。<br>
    </p>

    <h4>ツールバー：自動生成</h4>
    <p>
      ダンジョン型のマップをランダムに生成するツールです。<br>
      あくまでも機械的な生成に留まりますので、基本的には雛形の生成として留めておいて、生成後に手直しすることをお勧めします。<br>
    </p>

    <h4>ツールバー：マップテスト</h4>
    <p>
      ゲームプログラムを起動して実際の歩行やイベントの起動等をテストします。<br>
      イベントレイヤーを選択した状態でタイルを右クリックすると、マップテスト時の初期位置を設定できます。<br>
      テスト開始時に Ctrlキー を押していると、各種スクリプト共通変数やイベント個別変数の値を設定することもできます。<br>
      イベント個別変数の値は編集対象のマップが変わるとイベント名が表示されなくなり無効となりますが、元のマップに戻ると復元されます。<br>
    </p>

    <h4>その他・小技集</h4>
    <ul class="disc">
      <li>[スポイト] … タイルを右クリック</li>
      <li>[範囲スポイト] … タイルを右ドラッグ</li>
      <li>[パレット範囲選択] … タイルパレットを左ドラッグ</li>
      <li>[オートタイル解除] … Shiftキーを押下したままタイルを配置</li>
      <li>[スケーリング] … Ctrlキーを押下したままマウスホイール</li>
      <li>[レイヤー切替]… 1~5キー</li>
      <li>
        タイルレイヤーのとき
        <ul class="circle">
          <li>[編集ツール変更] … Q/W/E/Rキー</li>
        </ul>
      </li>
      <li>
        イベントレイヤーのとき
        <ul class="circle">
          <li>[カーソル移動] … W/A/S/Dキー</li>
          <li>[新規イベント] … Qキー</li>
          <li>[イベント編集] … Eキー</li>
        </ul>
      </li>
    </ul>
  </div>
  <hr>

  <!-- 子ノード見出し -->
  <h3 id="6">イベント編集</h3>
  <div class="text">
    <!-- 子ノードのテキスト -->
    <p>
      イベントレイヤーを選択した状態で、タイルの右クリックメニューの「ここに追加」コマンドからイベントテンプレートのダイアログが開きます。<br>
      イベントを選択した状態でダブルクリックすると、直接イベントの編集画面が開きます。<br>
    </p>

    <h4>イベント テンプレート</h4>
    <ul class="disc">
      <li>[プレーン] … 白紙の状態から編集を開始します。</li>
      <li>[リンク] … マップ間移動を行うイベントです。移動後の向きを「中立」にすると、移動前の向きが維持されます。</li>
      <li>[ドア] … 押すと開くドアのイベントです。前提条件は「鍵」に相当し、ドアを開けるのに必要な所持アイテムを指定します。</li>
      <li>[ドア＋リンク] … ドアとリンクのイベントを合わせたものです。ドアが開くと自動的に一歩前進してマップ間移動を行います。</li>
      <li>[村人] … 一般的な会話メッセージのイベントです。中断記号を挿入すると、ウィンドウを閉じずに処理を継続することができます。</li>
      <li>[財宝] … 調べるとお金やアイテムを入手できるイベントです。前提条件は「鍵」に相当し、財宝を入手するのに必要な所持アイテムを指定します。「イベント個別変数」には中身の財宝を取ったかどうかを判定するのに使用する変数を指定します。</li>
      <li>[お店カウンター] … ショップシーンを呼び出すイベントです。ここで登録した商品が売り出されます。</li>
      <li>[ユーザー定義] … ユーザーによって登録されたテンプレートです。</li>
    </ul>

    <h4>イベント編集画面</h4>
    <ul class="disc">
      <li>
        [起動条件] … イベントが起動するタイミングです。
        <ul class="circle">
          <li>[起動しない] … 一般的な方法では起動しません。スクリプトからの明示的な呼び出しでのみ実行できます。</li>
          <li>[決定キー押下] … 主人公側がイベントに向かって接している状態か、一致している状態で決定キーを押すと起動します。</li>
          <li>[主人公から接触] … 主人公側がイベントに対して押すか、一致すると起動します。</li>
          <li>[イベントから接触] … イベント側が主人公に対して押すか、一致すると起動します。主人公から接触した場合も起動します。</li>
          <li>[自動] … 起動条件のスクリプトで true が返される間、毎フレーム起動します。起動している間は他のシステム処理が停止します。</li>
          <li>[マップ移動直後] … マップに移動したとき、フェードインする前に起動します。起動条件のスクリプトで詳細な条件を設定できます。</li>
          <li>[並列実行] … 起動条件のスクリプトで true が返される間、毎フレーム並列的に実行されます。起動している間もできる限り他のシステム処理を継続します。</li>
        </ul>
      </li>

      <li>
        [日常移動] … イベントの自律移動パターンです。
        <ul class="circle">
          <li>[移動しない] … 移動しません。</li>
          <li>[ランダム] … 初期位置を中心として 5x5 の範囲内でランダムに移動します。</li>
          <li>[主人公に近づく] … 主人公にできるだけ近づこうとします。単純なアルゴリズムなので、途中に障害物がある場合は避けられません。</li>
          <li>[主人公から遠ざかる] … 主人公からできるだけ距離を置こうとします。単純なアルゴリズムなので、途中に障害物がある場合は避けられません。</li>
          <li>[ユーザー定義] … 日常移動のスクリプトでパターンを定義します。</li>
        </ul>
      </li>

      <li>
        その他の設定
        <ul class="circle">
          <li>[速度] … 移動するときの速さを示します。</li>
          <li>[頻度] … 移動を待機する時間の間隔を示します。</li>
          <li>[既定アニメ状態] … イベントの初期状態のアニメーションパターンを示します。静止時や移動時のアニメーションが有効な場合は最初の1フレームのみ適用されます。</li>
          <li>[描画優先度] … 主人公を基準とした描画の優先度を示します。「主人公より下」は通常タイルより上に、「主人公より上」は影より上、最前面表示のタイルより下に描画されます。</li>
          <li>[接触範囲の拡張] … 起動条件で「接触」に関わる判定について、その有効範囲を拡張します。0x0 のときイベント座標が接触点となり、その座標を中心として広がります。エディター上では赤い線で示されます。</li>
          <li>[静止時にアニメーションする] … 移動を待機している間にアニメーションを行うかどうかを設定します。</li>
          <li>[移動時にアニメーションする] … 移動中にアニメーションを行うかどうかを設定します。</li>
          <li>[すり抜ける] … 当たり判定を持たないようにするかどうかを設定します。</li>
          <li>[方向を固定する] … イベントの向きを変更できないようにするかどうかを設定します。</li>
        </ul>
      </li>

      <li>
        イベントスクリプト
        <ul class="circle">
          <li>[ページ条件] … 該当ページが有効であるかを判定します。return (条件式); で true となった場合に有効となります。</li>
          <li>[起動条件] … イベントが起動できるかどうかを判定します。return (条件式); で true となった場合に有効となります。</li>
          <li>[日常移動] … イベントの自律移動を定義します。日常移動が「スクリプト」定義にセットされている場合にのみ有効となります。単純な経路であればコマンドツリー「ツール：イベント日常移動の経路」から簡単に挿入できます。</li>
          <li>[実行内容] … イベントが起動したときの動作内容を定義します。</li>
        </ul>
      </li>

      <li>[テンプレートへ登録] … 現在編集しているイベントの情報をまとめてテンプレートとして保存します。保存したデータはイベントテンプレート画面からいつでも再利用できるようになります。</li>
    </ul>
  </div>
  <hr>

</div><!-- /#mainContainer -->
</div><!-- /#container -->
</body>
</html>
